# Key functions for terminal format parsing and printing
**SUCCESS! KEEP THIS FOR RECORDS**
Based on my search, the output you see is generated by the format_entry_line() function in app/modules/keepers/layerslayer.py. Let me show you the relevant code:

flowchart TD
    A[main.py] --> B[layerslayer_bulk]
    B --> C[peek_layer_blob_complete]
    C --> D[TarEntry objects]
    D --> E[display_peek_result]
    E --> F[format_entry_line]
    F --> G["drwxr-xr-x  0  0  0.0 B  2025-12-17 20:12  git/"]


## Key Functions:

```python
    def format_entry_line(entry, show_permissions=True):
    if show_permissions:
        size_str = human_readable_size(entry.size).rjust(8)
        if entry.is_symlink and entry.linkname:
            name_display = f"{entry.name} -> {entry.linkname}"
        else:
            name_display = entry.name + ("/" if entry.is_dir else "")
        return f"  {entry.mode}  {entry.uid:4d} {entry.gid:4d}  {size_str}  {entry.mtime}  {name_display}"
```

This produces lines like  

```bash
drwxr-xr-x     0    0     0.0 B  2025-12-17 20:12  git/
```

2. display_peek_result - iterates entries and prints info:

```python
def display_peek_result(result: LayerPeekResult, layer_size: int, verbose: bool = False):
    print("\n  Layer contents:\n")
    for entry in result.entries:
        print(format_entry_line(entry, show_permissions=True))

```

3. `TarEntry` dataclass - contains the parsed metadata:

```python
@dataclass
class TarEntry:
    name: str           # "git/"
    size: int           # 0
    typeflag: str       # '5' for directory
    is_dir: bool        # True
    mode: str           # "drwxr-xr-x"
    uid: int            # 0
    gid: int            # 0
    mtime: str          # "2025-12-17 20:12"
    linkname: str       # "" (empty for non-symlinks)
    is_symlink: bool    # False

```
 
The existing fs_faker.py already parses the same format. The key insight is that you're parsing the text output from these functions, not the raw tar data.

Thee parser uses this regex:

```python
LINE_PATTERN = re.compile(
    r'^\s*([dlrwx\-]{10})\s+'     # permissions
    r'(\d+)\s+(\d+)\s+'            # uid gid
    r'([\d.]+\s*[BKMGT]?B?)\s+'   # size
    r'(\d{4}-\d{2}-\d{2})\s+'     # date
    r'(\d{2}:\d{2})\s+'           # time
    r'(.+)$'                       # path (and optional -> link)
)
```

Which matches the output format from format_entry_line().